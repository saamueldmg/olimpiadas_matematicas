<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrar Preguntas</title>
    <!-- Tailwind CSS y Fuentes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome para los iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .container { max-width: 900px; }
        .accordion-header { cursor: pointer; transition: background-color 0.2s ease; }
        .accordion-header:hover { background-color: #f3f4f6; }
        .accordion-content { display: none; }
        .accordion-content.open { display: block; }
    </style>
</head>
<body class="bg-gray-100 flex items-start justify-center min-h-screen p-8">
    <div class="container mx-auto p-8 bg-white rounded-xl shadow-lg">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">
            <i class="fas fa-list-alt text-yellow-500 mr-2"></i> Administrar Preguntas
        </h1>
        
        <!-- Usamos un diccionario para no repetir el código del acordeón -->
        {% set levels = {'Nivel I': nivel1, 'Nivel II': nivel2, 'Nivel III': nivel3} %}
        
        {% for level_name, questions in levels.items() %}
        <div class="accordion-item border-b">
            <div class="accordion-header flex justify-between items-center text-xl font-bold text-gray-700 p-4 bg-gray-50">
                <!-- CAMBIO: Añadido el contador de preguntas -->
                <span>
                    {{ level_name }}
                    <span class="text-sm font-normal text-gray-500 ml-2">
                        ({{ questions | length }} {% if questions | length == 1 %}pregunta{% else %}preguntas{% endif %})
                    </span>
                </span>
                <i class="fas fa-chevron-down text-gray-500"></i>
            </div>
            <div class="accordion-content p-4 space-y-6 bg-white">
                <!-- Verificamos si hay preguntas en la lista que nos pasó Flask -->
                {% if questions %}
                    {% for question in questions %}
                    <div class="border-b pb-4 mb-4">
                        <img src="{{ url_for('static', filename='images/' + question.question_image) }}" alt="Imagen de la pregunta" class="max-w-xs mx-auto mb-4 rounded-lg shadow">
                        <ul class="list-none space-y-2">
                            <!-- Iteramos sobre las opciones de la pregunta -->
                            {% for key, value in question.options.items() %}
                            <li class="{% if key == question.correct %}font-bold text-green-600{% endif %}">
                                <i class="{% if key == question.correct %}fas fa-check-circle{% else %}far fa-circle{% endif %} mr-2"></i>
                                <strong>{{ key.upper() }})</strong> {{ value }}
                            </li>
                            {% endfor %}
                        </ul>
                        <div class="mt-4 text-right">
                            <!-- Formulario que envía la acción de borrar a app.py -->
                            <form action="{{ url_for('delete_question', question_id=question.id) }}" method="POST">
                                <button type="submit" class="bg-red-600 text-white py-2 px-4 rounded-lg shadow-md hover:bg-red-700 transition">
                                    <i class="fas fa-trash-alt mr-2"></i> Eliminar
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-center text-gray-500">No hay preguntas en este nivel.</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        
        <div class="mt-8 text-center">
            <a href="{{ url_for('dashboard') }}" class="w-full sm:w-auto inline-block bg-gray-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-gray-600 transition">
                <i class="fas fa-arrow-left mr-2"></i> Volver al Dashboard
            </a>
        </div>
    </div>

    <!-- JavaScript para la funcionalidad del acordeón -->
    <script>
        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                const icon = header.querySelector('i');
                
                // Cierra otros acordeones abiertos
                document.querySelectorAll('.accordion-content.open').forEach(openContent => {
                    if (openContent !== content) {
                        openContent.classList.remove('open');
                        openContent.previousElementSibling.querySelector('i').classList.remove('fa-chevron-up');
                        openContent.previousElementSibling.querySelector('i').classList.add('fa-chevron-down');
                    }
                });

                // Abre o cierra el actual
                content.classList.toggle('open');
                icon.classList.toggle('fa-chevron-down');
                icon.classList.toggle('fa-chevron-up');
            });
        });
    </script>
</body>
</html>

