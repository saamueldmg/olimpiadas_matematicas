<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iniciar Concurso - Olimpiadas Matemáticas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .level-button {
        transition: all 0.3s ease;
        opacity: 0.6;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .level-button::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }
      .level-button:hover::before {
        width: 300px;
        height: 300px;
      }
      .level-button.active {
        opacity: 1;
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }
      .custom-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
        cursor: pointer;
      }
      .custom-select::-webkit-scrollbar {
        width: 10px;
      }
      .custom-select::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 10px;
        margin: 4px;
      }
      .custom-select::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
        border-radius: 10px;
        border: 2px solid #f1f5f9;
      }
      .custom-select::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
      }
      .custom-select:disabled {
        background-color: #f3f4f6;
        cursor: not-allowed;
        opacity: 0.6;
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in-up {
        animation: fadeInUp 0.6s ease-out;
      }
    </style>
  </head>
  <body class="min-h-screen p-4 sm:p-6 md:p-8">
    <script>
      const teamsData = {
          nivel1: {{ teams_n1 | tojson }},
          nivel2: {{ teams_n2 | tojson }}
      };
    </script>

    <div class="container mx-auto max-w-5xl animate-fade-in-up">
      <header
        class="bg-white rounded-2xl shadow-xl p-6 mb-8 flex flex-col sm:flex-row justify-between items-center"
      >
        <div class="flex items-center space-x-4">
          <div
            class="bg-gradient-to-br from-purple-500 to-indigo-600 text-white p-4 rounded-xl shadow-lg"
          >
            <i class="fas fa-rocket text-3xl"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-800">Iniciar Concurso</h1>
            <p class="text-gray-500">
              Prepara la competencia seleccionando los equipos y el nivel
            </p>
          </div>
        </div>
        <a
          href="{{ url_for('quiz.dashboard') }}"
          class="mt-4 sm:mt-0 flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
        >
          <i class="fas fa-arrow-left"></i>
          <span>Volver</span>
        </a>
      </header>

      <main class="bg-white p-8 rounded-3xl shadow-2xl">
        {% if error %}
        <div
          class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg mb-6 animate-fade-in-up"
          role="alert"
        >
          <div class="flex items-center">
            <i class="fas fa-exclamation-triangle text-2xl mr-3"></i>
            <div>
              <p class="font-bold">¡Atención!</p>
              <p>{{ error }}</p>
            </div>
          </div>
        </div>
        {% endif %}

        <form
          id="quiz-form"
          action="{{ url_for('quiz.select_level') }}"
          method="post"
          class="space-y-10"
        >
          <input type="hidden" name="level" id="selected-level" value="" />

          <section>
            <div class="flex items-center mb-6">
              <div
                class="bg-purple-100 text-purple-600 w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg mr-4"
              >
                1
              </div>
              <h2 class="text-2xl font-bold text-gray-800">
                Elige el Nivel del Desafío
              </h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div
                id="btn-nivel1"
                data-level="Nivel I"
                data-key="nivel1"
                class="level-button bg-gradient-to-br from-blue-500 to-blue-600 text-white font-bold py-8 px-6 rounded-2xl shadow-lg text-center hover:shadow-2xl"
              >
                <i class="fas fa-award text-4xl mb-3 block"></i>
                <span class="text-2xl block">Nivel I</span>
                <span class="block text-sm opacity-90 mt-2">6° - 7°</span>
              </div>
              <div
                id="btn-nivel2"
                data-level="Nivel II"
                data-key="nivel2"
                class="level-button bg-gradient-to-br from-purple-500 to-purple-600 text-white font-bold py-8 px-6 rounded-2xl shadow-lg text-center hover:shadow-2xl"
              >
                <i class="fas fa-medal text-4xl mb-3 block"></i>
                <span class="text-2xl block">Nivel II</span>
                <span class="block text-sm opacity-90 mt-2">8° - 9°</span>
              </div>
              <div
                id="btn-nivel3"
                data-level="Nivel III"
                data-key="nivel3"
                class="level-button bg-gradient-to-br from-red-500 to-red-600 text-white font-bold py-8 px-6 rounded-2xl shadow-lg text-center hover:shadow-2xl"
              >
                <i class="fas fa-trophy text-4xl mb-3 block"></i>
                <span class="text-2xl block">Nivel III</span>
                <span class="block text-sm opacity-90 mt-2">10° - 11°</span>
              </div>
            </div>
          </section>

          <div class="relative">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t-2 border-gray-200"></div>
            </div>
            <div class="relative flex justify-center">
              <span class="bg-white px-4 text-gray-400">
                <i class="fas fa-arrow-down"></i>
              </span>
            </div>
          </div>

          <section>
            <div class="flex items-center mb-6">
              <div
                class="bg-indigo-100 text-indigo-600 w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg mr-4"
              >
                2
              </div>
              <h2 class="text-2xl font-bold text-gray-800">
                Selecciona los Contendientes
              </h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <!-- Equipo 1 -->
              <div
                class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-2xl border-2 border-gray-200"
              >
                <label
                  for="team1"
                  class="flex items-center text-lg font-bold text-gray-700 mb-3"
                >
                  <i class="fas fa-users text-blue-500 mr-3 text-xl"></i>
                  Equipo 1
                </label>
                <select
                  name="team1"
                  id="team1"
                  required
                  size="5"
                  class="custom-select w-full p-4 border-2 border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-4 focus:ring-purple-200 focus:border-purple-500 text-base bg-white transition-all"
                  style="height: 200px; overflow-y: auto"
                  disabled
                >
                  <option value="">Selecciona un nivel primero...</option>
                </select>
              </div>

              <!-- Equipo 2 -->
              <div
                class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-2xl border-2 border-gray-200"
              >
                <label
                  for="team2"
                  class="flex items-center text-lg font-bold text-gray-700 mb-3"
                >
                  <i class="fas fa-users text-purple-500 mr-3 text-xl"></i>
                  Equipo 2
                </label>
                <select
                  name="team2"
                  id="team2"
                  required
                  size="5"
                  class="custom-select w-full p-4 border-2 border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-4 focus:ring-purple-200 focus:border-purple-500 text-base bg-white transition-all"
                  style="height: 200px; overflow-y: auto"
                  disabled
                >
                  <option value="">Selecciona un nivel primero...</option>
                </select>
              </div>
            </div>
          </section>

          <div class="text-center pt-6">
            <button
              id="submit-button"
              type="submit"
              class="w-full md:w-auto bg-gray-400 text-white font-bold py-5 px-12 rounded-2xl shadow-lg transition-all duration-300 cursor-not-allowed text-lg"
              disabled
            >
              <i class="fas fa-lock mr-2"></i>
              Selecciona un Nivel
            </button>
          </div>
        </form>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const team1Select = document.getElementById("team1");
        const team2Select = document.getElementById("team2");
        const selectedLevelInput = document.getElementById("selected-level");
        const submitButton = document.getElementById("submit-button");
        const form = document.getElementById("quiz-form");

        const levelButtons = [
          document.getElementById("btn-nivel1"),
          document.getElementById("btn-nivel2"),
          document.getElementById("btn-nivel3"),
        ];

        function populateSelect(selectElement, teams) {
          selectElement.innerHTML = "";

          if (!teams || teams.length === 0) {
            selectElement.disabled = true;
            selectElement.innerHTML =
              '<option value="">No hay equipos para este nivel</option>';
            return;
          }

          selectElement.disabled = false;
          selectElement.innerHTML =
            '<option value="" disabled selected>Selecciona un equipo...</option>';

          teams.forEach((team) => {
            const option = document.createElement("option");
            option.value = team;
            option.textContent = team;
            selectElement.appendChild(option);
          });
        }

        levelButtons.forEach((button) => {
          button.addEventListener("click", (e) => {
            e.preventDefault();

            levelButtons.forEach((btn) => btn.classList.remove("active"));
            button.classList.add("active");

            const levelName = button.dataset.level;
            const levelKey = button.dataset.key;

            selectedLevelInput.value = levelName;

            const teamsForLevel = teamsData[levelKey] || [];
            populateSelect(team1Select, teamsForLevel);
            populateSelect(team2Select, teamsForLevel);

            if (teamsForLevel.length > 0) {
              submitButton.disabled = false;
              submitButton.innerHTML =
                '<i class="fas fa-play-circle mr-2"></i> Iniciar Duelo - ' +
                levelName;
              submitButton.classList.remove(
                "bg-gray-400",
                "cursor-not-allowed"
              );
              submitButton.classList.add(
                "bg-gradient-to-r",
                "from-purple-600",
                "to-indigo-600",
                "hover:from-purple-700",
                "hover:to-indigo-700",
                "transform",
                "hover:scale-105",
                "hover:shadow-2xl"
              );
            } else {
              submitButton.disabled = true;
              submitButton.innerHTML =
                '<i class="fas fa-exclamation-circle mr-2"></i> No hay equipos para ' +
                levelName;
              submitButton.classList.add("bg-gray-400", "cursor-not-allowed");
              submitButton.classList.remove(
                "bg-gradient-to-r",
                "from-purple-600",
                "to-indigo-600",
                "hover:from-purple-700",
                "hover:to-indigo-700",
                "transform",
                "hover:scale-105",
                "hover:shadow-2xl"
              );
            }
          });
        });

        function syncSelectors(changedSelect, targetSelect) {
          if (
            changedSelect.value === targetSelect.value &&
            changedSelect.value !== ""
          ) {
            targetSelect.selectedIndex = 0;
          }
        }

        team1Select.addEventListener("change", () =>
          syncSelectors(team1Select, team2Select)
        );
        team2Select.addEventListener("change", () =>
          syncSelectors(team2Select, team1Select)
        );

        form.addEventListener("submit", (e) => {
          if (!selectedLevelInput.value) {
            e.preventDefault();
            alert(
              "Por favor, selecciona un nivel haciendo clic en uno de los botones."
            );
          }
        });
      });
    </script>
  </body>
</html>
